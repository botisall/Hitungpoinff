<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hitung Poin By Isall</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f0f0f,#1c1c1c);
  color:white;
}

.page{
  display:none;
  min-height:100vh;
  padding:20px;
}

.active{
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* LOGIN */
.loginBox{
  width:90%;
  max-width:350px;
  background:#1e1e1e;
  padding:30px;
  border-radius:20px;
  text-align:center;
  box-shadow:0 0 40px rgba(255,0,0,0.5);
}

.loginBox h2{
  color:#ff2e2e;
  margin-bottom:25px;
}

.content{
  width:100%;
  max-width:1200px;
  text-align:center;
}

input,button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border:none;
  border-radius:8px;
}

input{
  background:#2a2a2a;
  color:white;
  text-align:center;
}

button{
  background:#ff2e2e;
  color:white;
  font-weight:bold;
}

button:hover{
  background:#cc0000;
}

/* TABLE */
.tableWrap{
  overflow:auto;
  background:white;
  border-radius:10px;
  padding:10px;
  margin-top:15px;
}

table{
  border-collapse:collapse;
  min-width:1100px;
  width:100%;
  table-layout:fixed;
  color:black;
}

th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
  vertical-align:middle;
  word-wrap:break-word;
}

th{
  background:#f2f2f2;
  position:sticky;
  top:0;
}

td[contenteditable]{
  background:#fafafa;
}

.rank1{background:gold !important;}
.rank2{background:silver !important;}
.rank3{background:#cd7f32 !important;}

@media print{
  body{
    background:white !important;
    color:black !important;
  }
  button{
    display:none;
  }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="page active">
<div class="loginBox">
<h2>HITUNG POIN BY ISALL</h2>
<input type="password" id="pass" placeholder="Masukkan Password">
<button onclick="login()">Login</button>
<button onclick="requestAdmin()">Request Admin</button>
</div>
</div>

<!-- TEAM INPUT -->
<div id="teamPage" class="page">
<div class="content">
<h2>Masukkan Nama Team (boleh kosong)</h2>
<div id="teamInputs"></div>
<button onclick="saveTeams()">Lanjut</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<!-- TABLE -->
<div id="tablePage" class="page">
<div class="content">
<h2>Leaderboard Spreadsheet</h2>
<button onclick="resetAll()">Reset Semua</button>
<button onclick="logout()">Logout</button>
<button onclick="openPrintPage()">Print / Save PDF</button>

<div class="tableWrap">
<table id="tabel">
<thead>
<tr>
<th>No</th>
<th>Team</th>
<th>M1 Kill</th><th>M1 Rank</th><th>M1 Total</th>
<th>M2 Kill</th><th>M2 Rank</th><th>M2 Total</th>
<th>M3 Kill</th><th>M3 Rank</th><th>M3 Total</th>
<th>Grand Total</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<script>

let passwords=["adminA1","adminB2","adminC3","adminD4","adminE5"];
let teams=JSON.parse(localStorage.getItem("teams"))||[];

/* LOGIN */
function login(){
let p=document.getElementById("pass").value;
let device=localStorage.getItem("devicePass");

if(passwords.includes(p)){
if(!device){
localStorage.setItem("devicePass",p);
localStorage.setItem("admin","yes");
nextPage();
}
else if(device===p){
localStorage.setItem("admin","yes");
nextPage();
}
else{
alert("Password sudah dipakai di HP lain!");
}
}else{
alert("Password salah!");
}
}

function logout(){
localStorage.removeItem("admin");
location.reload();
}

function requestAdmin(){
window.open("https://wa.me/6281234567890?text=Saya%20ingin%20jadi%20admin");
}

/* NAVIGATION */
function nextPage(){
loginPage.classList.remove("active");
if(teams.length==12){
showTable();
}else{
teamPage.classList.add("active");
createInputs();
}
}

function showTable(){
teamPage.classList.remove("active");
tablePage.classList.add("active");
renderTable();
}

/* TEAM INPUT */
function createInputs(){
let html="";
for(let i=1;i<=12;i++){
html+=`<input type="text" placeholder="Nama Team ${i}" id="team${i}"><br>`;
}
teamInputs.innerHTML=html;
}

function saveTeams(){
teams=[];
for(let i=1;i<=12;i++){
let name=document.getElementById("team"+i).value.trim();
if(name==="") name="Team "+i;
teams.push({name,k1:0,r1:0,k2:0,r2:0,k3:0,r3:0});
}
localStorage.setItem("teams",JSON.stringify(teams));
showTable();
}

/* POINT SYSTEM */
function rankPoint(r){
switch(parseInt(r)){
case 1:return 12;
case 2:return 9;
case 3:return 8;
case 4:return 7;
case 5:return 6;
case 6:return 5;
case 7:return 4;
case 8:return 3;
case 9:return 2;
case 10:return 1;
default:return 0;
}
}

function renderTable(){

teams.sort((a,b)=>{
let ta=(a.k1+rankPoint(a.r1))+(a.k2+rankPoint(a.r2))+(a.k3+rankPoint(a.r3));
let tb=(b.k1+rankPoint(b.r1))+(b.k2+rankPoint(b.r2))+(b.k3+rankPoint(b.r3));
return tb-ta;
});

let tbody="";

teams.forEach((t,i)=>{

let m1=t.k1+rankPoint(t.r1);
let m2=t.k2+rankPoint(t.r2);
let m3=t.k3+rankPoint(t.r3);
let total=m1+m2+m3;

let rankClass="";
if(i==0)rankClass="rank1";
if(i==1)rankClass="rank2";
if(i==2)rankClass="rank3";

tbody+=`
<tr class="${rankClass}">
<td>${i+1}</td>
<td>${t.name}</td>
<td contenteditable oninput="update(${i},'k1',this.innerText)">${t.k1}</td>
<td contenteditable oninput="update(${i},'r1',this.innerText)">${t.r1}</td>
<td>${m1}</td>
<td contenteditable oninput="update(${i},'k2',this.innerText)">${t.k2}</td>
<td contenteditable oninput="update(${i},'r2',this.innerText)">${t.r2}</td>
<td>${m2}</td>
<td contenteditable oninput="update(${i},'k3',this.innerText)">${t.k3}</td>
<td contenteditable oninput="update(${i},'r3',this.innerText)">${t.r3}</td>
<td>${m3}</td>
<td>${total}</td>
</tr>
`;
});

document.querySelector("#tabel tbody").innerHTML=tbody;
localStorage.setItem("teams",JSON.stringify(teams));
}

function update(i,key,value){
teams[i][key]=parseInt(value)||0;
renderTable();
}

/* PRINT */
function openPrintPage(){
window.print();
}

function resetAll(){
if(confirm("Reset semua data?")){
localStorage.removeItem("teams");
location.reload();
}
}

if(localStorage.getItem("admin")=="yes"){
nextPage();
}

</script>

</body>
</html>
