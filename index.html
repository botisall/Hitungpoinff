<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hitung Poin By Isall</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{
  --red:#CC0000;
  --red2:#FF2222;
  --gold:#FFD700;
  --silver:#C0C0C0;
  --bronze:#CD7F32;
  --dark:#0A0A0A;
  --dark2:#111111;
  --dark3:#1A1A1A;
  --card:#181818;
  --border:rgba(204,0,0,0.35);
  --text:#FFFFFF;
  --muted:#888;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  font-family:'Barlow Condensed','Rajdhani',Arial,sans-serif;
  background:var(--dark);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}
body::before{
  content:'';
  position:fixed;inset:0;
  background:
    radial-gradient(ellipse at 0% 0%,rgba(204,0,0,0.12) 0%,transparent 50%),
    radial-gradient(ellipse at 100% 100%,rgba(100,0,0,0.1) 0%,transparent 50%);
  pointer-events:none;z-index:0;
}

/* ===== PAGE ===== */
.page{display:none;min-height:100vh;position:relative;z-index:1;}
.page.active{display:flex;justify-content:center;align-items:flex-start;flex-direction:column;}

/* ===== LOGIN PAGE ===== */
#loginPage{align-items:center;justify-content:center;}
.login-wrap{
  width:90%;max-width:360px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:20px;
  padding:36px 28px;
  text-align:center;
  box-shadow:0 0 60px rgba(204,0,0,0.25),0 0 120px rgba(204,0,0,0.08);
  position:relative;overflow:hidden;
}
.login-wrap::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,transparent,var(--red2),var(--gold),var(--red2),transparent);
}
.login-logo{
  font-family:'Barlow Condensed',sans-serif;
  font-size:13px;letter-spacing:5px;color:var(--red2);
  text-transform:uppercase;margin-bottom:6px;
}
.login-title{
  font-size:28px;font-weight:900;letter-spacing:3px;
  color:white;text-transform:uppercase;line-height:1.1;
  margin-bottom:4px;
}
.login-sub{font-size:12px;color:var(--muted);letter-spacing:3px;margin-bottom:28px;}
.login-divider{width:60px;height:2px;background:linear-gradient(90deg,transparent,var(--red),transparent);margin:0 auto 28px;}

.inp{
  width:100%;padding:13px 16px;margin-bottom:12px;
  background:#111;border:1px solid rgba(204,0,0,0.3);
  border-radius:10px;color:white;
  font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:600;
  outline:none;text-align:center;transition:border-color 0.2s;
  -webkit-appearance:none;
}
.inp:focus{border-color:var(--red2);}
.inp::placeholder{color:var(--muted);font-weight:400;}

.btn{
  width:100%;padding:13px;border:none;border-radius:10px;
  font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;
  letter-spacing:3px;cursor:pointer;text-transform:uppercase;
  transition:all 0.2s;margin-bottom:8px;
}
.btn-red{background:linear-gradient(135deg,#CC0000,#880000);color:white;box-shadow:0 4px 20px rgba(204,0,0,0.3);}
.btn-red:active{transform:scale(0.98);}
.btn-outline{background:transparent;color:var(--muted);border:1px solid rgba(204,0,0,0.3);}
.btn-outline:active{border-color:var(--red2);color:white;}
.btn-gold{background:linear-gradient(135deg,#aa8800,#665500);color:var(--gold);border:1px solid rgba(255,215,0,0.3);}
.btn-green{background:linear-gradient(135deg,#006600,#004400);color:#44ff44;border:1px solid rgba(0,255,0,0.2);}

/* ===== TEAM PAGE ===== */
#teamPage{align-items:center;padding:0 0 30px;}
.team-header{
  width:100%;background:linear-gradient(180deg,#1A0000,var(--dark));
  border-bottom:2px solid var(--border);
  padding:20px 20px 16px;text-align:center;
}
.team-header h2{font-size:22px;font-weight:900;letter-spacing:3px;color:white;}
.team-header p{font-size:12px;color:var(--muted);letter-spacing:2px;margin-top:4px;}

.team-body{width:100%;max-width:480px;padding:16px 14px;}
.team-count-bar{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--card);border:1px solid var(--border);
  border-radius:10px;padding:12px 16px;margin-bottom:14px;
}
.team-count-label{font-size:12px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
.team-count-val{font-size:22px;font-weight:700;color:var(--red2);font-family:'Barlow Condensed',sans-serif;}

.team-slot{
  display:flex;align-items:center;gap:10px;
  background:var(--card);border:1px solid rgba(204,0,0,0.2);
  border-radius:10px;padding:10px 12px;margin-bottom:8px;
  transition:border-color 0.2s;
}
.team-slot.filled{border-color:rgba(204,0,0,0.5);}
.slot-num{
  font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;
  color:var(--red2);min-width:26px;text-align:center;
}
.slot-inp{
  flex:1;padding:9px 10px;background:#111;
  border:1px solid rgba(204,0,0,0.2);border-radius:8px;
  color:white;font-family:'Barlow Condensed',sans-serif;
  font-size:15px;font-weight:600;outline:none;
  transition:border-color 0.2s;
}
.slot-inp:focus{border-color:var(--red2);}
.slot-inp::placeholder{color:#555;font-weight:400;}
.slot-del{
  width:32px;height:32px;background:#1A0000;border:1px solid rgba(204,0,0,0.3);
  border-radius:8px;color:var(--red2);font-size:16px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;flex-shrink:0;
}
.slot-del:active{background:var(--red);color:white;}

.add-slot-btn{
  width:100%;padding:11px;background:#111;
  border:1px dashed rgba(204,0,0,0.35);
  border-radius:10px;color:var(--muted);
  font-family:'Barlow Condensed',sans-serif;
  font-size:13px;letter-spacing:2px;cursor:pointer;
  transition:all 0.2s;margin-bottom:14px;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.add-slot-btn:active{border-color:var(--red2);color:white;}

.sticky-btns{
  width:100%;max-width:480px;padding:0 14px;
  position:sticky;bottom:0;background:linear-gradient(transparent,var(--dark) 30%);
  padding-top:20px;padding-bottom:16px;
}

/* ===== TABLE PAGE ===== */
#tablePage{align-items:center;padding:0;}
.tbl-header{
  width:100%;
  background:linear-gradient(180deg,#1A0000,var(--dark));
  border-bottom:2px solid var(--border);
  padding:14px 16px 12px;
  display:flex;align-items:center;justify-content:space-between;
}
.tbl-title{
  font-family:'Barlow Condensed',sans-serif;
  font-size:20px;font-weight:900;letter-spacing:3px;color:white;
}
.tbl-sub{font-size:11px;color:var(--muted);letter-spacing:2px;}
.tbl-action-bar{
  width:100%;padding:10px 14px;
  display:flex;gap:8px;overflow-x:auto;
  background:var(--dark2);border-bottom:1px solid rgba(204,0,0,0.15);
}
.tbl-action-bar::-webkit-scrollbar{display:none;}
.act-btn{
  flex-shrink:0;padding:8px 14px;border:none;border-radius:8px;
  font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;
  letter-spacing:2px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;
}
.act-red{background:rgba(204,0,0,0.2);color:var(--red2);border:1px solid var(--border);}
.act-gold{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.3);}
.act-green{background:rgba(0,200,0,0.1);color:#44ff44;border:1px solid rgba(0,200,0,0.3);}
.act-blue{background:rgba(0,150,255,0.1);color:#44aaff;border:1px solid rgba(0,150,255,0.3);}
.act-btn:active{opacity:0.7;}

/* TOP 3 PODIUM */
.podium-wrap{
  width:100%;padding:14px 14px 0;
  display:flex;gap:8px;align-items:flex-end;
  max-width:480px;
}
.podium-item{
  flex:1;border-radius:10px 10px 0 0;padding:10px 6px;
  text-align:center;position:relative;overflow:hidden;
}
.p1{background:linear-gradient(180deg,rgba(255,215,0,0.15),rgba(255,215,0,0.05));border:1px solid rgba(255,215,0,0.4);border-bottom:none;min-height:90px;}
.p2{background:linear-gradient(180deg,rgba(192,192,192,0.12),rgba(192,192,192,0.04));border:1px solid rgba(192,192,192,0.3);border-bottom:none;min-height:75px;}
.p3{background:linear-gradient(180deg,rgba(205,127,50,0.12),rgba(205,127,50,0.04));border:1px solid rgba(205,127,50,0.3);border-bottom:none;min-height:65px;}
.podium-crown{font-size:22px;display:block;margin-bottom:2px;}
.podium-name{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.podium-score{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:900;}
.p1 .podium-score{color:var(--gold);}
.p2 .podium-score{color:var(--silver);}
.p3 .podium-score{color:var(--bronze);}

/* TABLE */
.tbl-wrap{
  width:100%;overflow-x:auto;
  padding:0 14px 20px;max-width:480px;
}
.tbl-wrap::-webkit-scrollbar{height:4px;}
.tbl-wrap::-webkit-scrollbar-track{background:#111;}
.tbl-wrap::-webkit-scrollbar-thumb{background:var(--red);border-radius:2px;}

table{
  border-collapse:collapse;
  width:100%;min-width:700px;
  font-family:'Barlow Condensed',sans-serif;
  font-size:14px;
}
thead tr{background:var(--red);}
th{
  padding:10px 8px;text-align:center;
  font-size:11px;letter-spacing:2px;font-weight:700;
  color:white;white-space:nowrap;
  position:sticky;top:0;z-index:2;
}
td{
  padding:9px 8px;text-align:center;
  border-bottom:1px solid rgba(204,0,0,0.12);
  color:white;transition:background 0.15s;
}
.r1 td{background:rgba(255,215,0,0.1)!important;}
.r2 td{background:rgba(192,192,192,0.07)!important;}
.r3 td{background:rgba(205,127,50,0.07)!important;}
.r1:first-child{border-left:3px solid var(--gold);}
.r2:first-child{border-left:3px solid var(--silver);}
.r3:first-child{border-left:3px solid var(--bronze);}
td[contenteditable]{background:rgba(255,255,255,0.04);cursor:text;}
td[contenteditable]:focus{background:rgba(204,0,0,0.15);outline:none;box-shadow:inset 0 0 0 1px var(--red2);}
.td-total{font-weight:700;font-size:16px;color:white;}
.td-grand{font-weight:900;font-size:18px;color:var(--gold);}
.td-rank{font-size:16px;}
.td-sub{font-size:12px;color:var(--muted);}

/* NOTIFICATION */
.notif{
  position:fixed;top:20px;left:50%;transform:translateX(-50%);
  background:linear-gradient(135deg,#1A0000,#111);
  border:1px solid var(--red2);border-radius:10px;
  padding:12px 24px;font-size:14px;font-weight:700;letter-spacing:1px;
  color:white;z-index:999;opacity:0;
  transition:opacity 0.3s;pointer-events:none;white-space:nowrap;
}
.notif.show{opacity:1;}

/* EXPORT SNAPSHOT */
#snapshot-target{background:var(--dark);padding:20px;}
.snap-title{
  text-align:center;
  font-family:'Barlow Condensed',sans-serif;
  font-size:24px;font-weight:900;letter-spacing:4px;
  color:var(--red2);margin-bottom:16px;
}

/* MODAL */
.modal-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,0.85);z-index:100;
  justify-content:center;align-items:center;
}
.modal-overlay.open{display:flex;}
.modal{
  width:90%;max-width:340px;
  background:var(--card);border:1px solid var(--border);
  border-radius:16px;padding:28px 22px;text-align:center;
  box-shadow:0 0 40px rgba(204,0,0,0.2);
}
.modal h3{font-size:18px;font-weight:700;letter-spacing:2px;margin-bottom:8px;color:var(--red2);}
.modal p{font-size:13px;color:var(--muted);margin-bottom:20px;line-height:1.5;}
</style>
</head>
<body>

<!-- NOTIF TOAST -->
<div class="notif" id="toast"></div>

<!-- RESET MODAL -->
<div class="modal-overlay" id="resetModal">
  <div class="modal">
    <h3>‚ö†Ô∏è RESET DATA</h3>
    <p>Semua data team dan poin akan dihapus.<br>Aksi ini tidak bisa dibatalkan!</p>
    <button class="btn btn-red" onclick="confirmReset()">Ya, Reset Semua</button>
    <button class="btn btn-outline" style="margin-top:0" onclick="closeModal()">Batal</button>
  </div>
</div>

<!-- ========== LOGIN ========== -->
<div id="loginPage" class="page active">
  <div class="login-wrap">
    <div class="login-logo">‚ö° Free Fire Tournament</div>
    <div class="login-title">Hitung Poin</div>
    <div class="login-sub">BY ISALL</div>
    <div class="login-divider"></div>
    <input class="inp" type="password" id="passInput" placeholder="Masukkan Password" onkeydown="if(event.key==='Enter')login()">
    <button class="btn btn-red" onclick="login()">üîì Login</button>
    <button class="btn btn-outline" onclick="requestAdmin()">üì± Request Admin</button>
  </div>
</div>

<!-- ========== TEAM INPUT ========== -->
<div id="teamPage" class="page">
  <div class="team-header">
    <h2>‚öîÔ∏è DAFTAR TEAM</h2>
    <p>TAMBAH MINIMAL 2 TEAM, MAKSIMAL 12 TEAM</p>
  </div>
  <div class="team-body">
    <div class="team-count-bar">
      <span class="team-count-label">Jumlah Team</span>
      <span class="team-count-val" id="teamCountVal">0 / 12</span>
    </div>
    <div id="teamSlots"></div>
    <button class="add-slot-btn" id="addSlotBtn" onclick="addSlot()">
      <span style="font-size:20px;color:var(--red2)">+</span> Tambah Team
    </button>
  </div>
  <div class="sticky-btns">
    <button class="btn btn-red" onclick="saveTeams()">‚úÖ SIMPAN & LANJUT</button>
    <button class="btn btn-outline" onclick="logout()">Logout</button>
  </div>
</div>

<!-- ========== TABLE ========== -->
<div id="tablePage" class="page">
  <div class="tbl-header">
    <div>
      <div class="tbl-title">LEADERBOARD</div>
      <div class="tbl-sub">BY ISALL ¬∑ 3 MATCH</div>
    </div>
    <div style="text-align:right">
      <div style="font-size:11px;color:var(--muted);letter-spacing:1px">POIN KILL</div>
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:26px;font-weight:900;color:var(--red2);line-height:1">√ó2</div>
    </div>
  </div>

  <div class="tbl-action-bar">
    <button class="act-btn act-gold" onclick="downloadIMG()">üì∑ Foto</button>
    <button class="act-btn act-blue" onclick="downloadPDF()">üìÑ PDF</button>
    <button class="act-btn act-green" onclick="switchToTeamPage()">‚úèÔ∏è Edit Tim</button>
    <button class="act-btn act-red" onclick="openModal()">üóë Reset</button>
    <button class="act-btn" style="background:rgba(255,255,255,0.05);color:var(--muted);border:1px solid rgba(255,255,255,0.1)" onclick="logout()">Logout</button>
  </div>

  <!-- TOP 3 PODIUM -->
  <div class="podium-wrap" id="podiumWrap" style="display:none"></div>

  <div class="tbl-wrap">
    <table id="mainTable">
      <thead>
        <tr>
          <th>#</th>
          <th>TEAM</th>
          <th>M1<br><span style="font-size:9px;opacity:0.7">KILL</span></th>
          <th>M1<br><span style="font-size:9px;opacity:0.7">RANK</span></th>
          <th>M1<br><span style="font-size:9px;opacity:0.7">TOTAL</span></th>
          <th>M2<br><span style="font-size:9px;opacity:0.7">KILL</span></th>
          <th>M2<br><span style="font-size:9px;opacity:0.7">RANK</span></th>
          <th>M2<br><span style="font-size:9px;opacity:0.7">TOTAL</span></th>
          <th>M3<br><span style="font-size:9px;opacity:0.7">KILL</span></th>
          <th>M3<br><span style="font-size:9px;opacity:0.7">RANK</span></th>
          <th>M3<br><span style="font-size:9px;opacity:0.7">TOTAL</span></th>
          <th>GRAND<br><span style="font-size:9px;opacity:0.7">TOTAL</span></th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
// ===== PASSWORDS =====
const PASSWORDS = ["adminA1","adminB2","adminC3","adminD4","adminE5"];

// ===== PLACEMENT POINTS (sesuai Master League S2) =====
// 1ST=20, 2ND=17, 3RD=15, 4TH=13, 5TH=12, 6TH=10, 7TH=6, 8TH=4, 9TH=3, 10TH=2, 11TH=1, 12TH=0
function rankPoint(r) {
  const pts = [20,17,15,13,12,10,6,4,3,2,1,0];
  const i = parseInt(r) - 1;
  if (i >= 0 && i < pts.length) return pts[i];
  return 0;
}
const KILL_MULT = 2;

// ===== STATE =====
let teams = [];
let slotCount = 0;

function loadData() {
  try {
    const t = localStorage.getItem("ff_isall_teams");
    if (t) teams = JSON.parse(t);
  } catch(e) { teams = []; }
}

function saveData() {
  try { localStorage.setItem("ff_isall_teams", JSON.stringify(teams)); } catch(e) {}
}

// ===== TOAST =====
let toastTimer;
function toast(msg, color='var(--red2)') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.style.borderColor = color;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

// ===== LOGIN =====
function login() {
  const p = document.getElementById('passInput').value.trim();
  if (!p) { toast('Masukkan password!'); return; }
  const device = localStorage.getItem("ff_isall_device");
  if (!PASSWORDS.includes(p)) { toast('‚ùå Password salah!'); return; }
  if (device && device !== p) { toast('‚ö†Ô∏è Password sudah dipakai di HP lain!'); return; }
  localStorage.setItem("ff_isall_device", p);
  localStorage.setItem("ff_isall_auth", "yes");
  toast('‚úÖ Login berhasil!', '#44ff44');
  setTimeout(() => {
    loadData();
    if (teams.length >= 2) showTablePage();
    else showTeamPage();
  }, 600);
}

function logout() {
  localStorage.removeItem("ff_isall_auth");
  location.reload();
}

function requestAdmin() {
  window.open("https://wa.me/6281234567890?text=Saya%20ingin%20request%20akses%20admin%20Hitung%20Poin%20By%20Isall");
}

// ===== NAVIGATION =====
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showTeamPage() {
  showPage('teamPage');
  renderSlots();
}

function showTablePage() {
  showPage('tablePage');
  renderTable();
}

function switchToTeamPage() {
  showTeamPage();
}

// ===== TEAM SLOTS =====
function renderSlots() {
  const container = document.getElementById('teamSlots');
  container.innerHTML = '';
  slotCount = teams.length;
  if (slotCount === 0) addSlot();
  else {
    teams.forEach((t, i) => renderOneSlot(i, t.name));
  }
  updateCount();
}

function renderOneSlot(idx, val='') {
  const container = document.getElementById('teamSlots');
  const div = document.createElement('div');
  div.className = 'team-slot' + (val ? ' filled' : '');
  div.id = 'slot_' + idx;
  div.innerHTML = `
    <div class="slot-num">${idx+1}</div>
    <input class="slot-inp" type="text" placeholder="Nama team ${idx+1}" value="${escHtml(val)}"
      oninput="onSlotInput(${idx},this)" id="sinp_${idx}">
    <button class="slot-del" onclick="removeSlot(${idx})">‚úï</button>
  `;
  container.appendChild(div);
}

function addSlot() {
  if (slotCount >= 12) { toast('Maksimal 12 team!'); return; }
  renderOneSlot(slotCount, '');
  slotCount++;
  updateCount();
  document.getElementById('addSlotBtn').style.display = slotCount >= 12 ? 'none' : 'flex';
}

function removeSlot(idx) {
  const el = document.getElementById('slot_' + idx);
  if (el) el.remove();
  reIndexSlots();
}

function reIndexSlots() {
  const slots = document.querySelectorAll('.team-slot');
  slotCount = slots.length;
  slots.forEach((s, i) => {
    s.id = 'slot_' + i;
    s.querySelector('.slot-num').textContent = i + 1;
    const inp = s.querySelector('.slot-inp');
    inp.placeholder = 'Nama team ' + (i+1);
    inp.id = 'sinp_' + i;
    inp.setAttribute('oninput', `onSlotInput(${i},this)`);
    s.querySelector('.slot-del').setAttribute('onclick', `removeSlot(${i})`);
  });
  updateCount();
  document.getElementById('addSlotBtn').style.display = slotCount >= 12 ? 'none' : 'flex';
}

function onSlotInput(idx, el) {
  const slot = document.getElementById('slot_' + idx);
  if (slot) slot.classList.toggle('filled', el.value.trim() !== '');
}

function updateCount() {
  document.getElementById('teamCountVal').textContent = slotCount + ' / 12';
}

function saveTeams() {
  const slots = document.querySelectorAll('.team-slot');
  const newTeams = [];
  slots.forEach(s => {
    const v = s.querySelector('.slot-inp').value.trim();
    if (v) newTeams.push(v);
  });
  if (newTeams.length < 2) { toast('Minimal 2 team!'); return; }

  // Preserve existing match data
  const oldTeams = [...teams];
  teams = newTeams.map(name => {
    const old = oldTeams.find(o => o.name === name);
   
