<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hitung Poin By Isall</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{
  --red:#CC0000;
  --red2:#FF3333;
  --gold:#FFD700;
  --silver:#C0C0C0;
  --bronze:#CD7F32;
  --dark:#0A0A0A;
  --dark2:#111111;
  --card:#181818;
  --border:rgba(204,0,0,0.4);
  --muted:#777;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{width:100%;overflow-x:hidden;}
body{
  font-family:'Barlow Condensed',Arial,sans-serif;
  background:var(--dark);color:#fff;
  min-height:100vh;
}
body::after{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse at 10% 10%,rgba(204,0,0,0.1),transparent 55%),
             radial-gradient(ellipse at 90% 90%,rgba(150,0,0,0.08),transparent 55%);
}

/* PAGES */
.page{display:none;min-height:100vh;flex-direction:column;align-items:center;justify-content:center;position:relative;z-index:1;}
.page.active{display:flex;}

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
.login-box{
  width:88%;max-width:340px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;padding:32px 24px;
  text-align:center;
  box-shadow:0 0 60px rgba(204,0,0,0.2);
  position:relative;overflow:hidden;
}
.login-box::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,transparent,var(--red2),var(--gold),var(--red2),transparent);
}
.login-ff{font-size:12px;letter-spacing:5px;color:var(--red2);margin-bottom:8px;}
.login-title{font-size:30px;font-weight:900;letter-spacing:4px;line-height:1;}
.login-by{font-size:12px;letter-spacing:4px;color:var(--muted);margin:6px 0 22px;}
.login-line{width:50px;height:2px;background:linear-gradient(90deg,transparent,var(--red),transparent);margin:0 auto 24px;}

.inp{
  display:block;width:100%;padding:13px 14px;margin-bottom:12px;
  background:#0f0f0f;border:1px solid rgba(204,0,0,0.35);
  border-radius:10px;color:#fff;
  font-family:'Barlow Condensed',Arial,sans-serif;
  font-size:17px;font-weight:600;text-align:center;outline:none;
  -webkit-appearance:none;transition:border-color .2s;
}
.inp:focus{border-color:var(--red2);}
.inp::placeholder{color:#444;font-weight:400;}

.btn{
  display:block;width:100%;padding:13px;border:none;border-radius:10px;
  font-family:'Barlow Condensed',Arial,sans-serif;
  font-size:14px;font-weight:700;letter-spacing:3px;
  cursor:pointer;text-transform:uppercase;transition:opacity .15s;
  margin-bottom:9px;
}
.btn:active{opacity:.75;}
.btn-red{background:linear-gradient(135deg,#CC0000,#880000);color:#fff;box-shadow:0 4px 18px rgba(204,0,0,0.35);}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid rgba(204,0,0,0.3);}

/* ‚îÄ‚îÄ TEAM PAGE ‚îÄ‚îÄ */
#teamPage{justify-content:flex-start;}
.pg-head{
  width:100%;background:linear-gradient(180deg,#1a0000,var(--dark));
  border-bottom:2px solid var(--border);
  padding:18px 16px 14px;text-align:center;
}
.pg-head h2{font-size:22px;font-weight:900;letter-spacing:3px;}
.pg-head p{font-size:11px;color:var(--muted);letter-spacing:2px;margin-top:3px;}

.team-body{width:100%;max-width:460px;padding:14px 14px 0;}
.count-bar{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--card);border:1px solid var(--border);
  border-radius:10px;padding:10px 14px;margin-bottom:12px;
}
.count-label{font-size:11px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
.count-val{font-size:22px;font-weight:700;color:var(--red2);}

.slot{
  display:flex;align-items:center;gap:8px;
  background:var(--card);border:1px solid rgba(204,0,0,0.2);
  border-radius:10px;padding:9px 10px;margin-bottom:7px;
  transition:border-color .2s;
}
.slot.filled{border-color:rgba(204,0,0,0.5);}
.slot-no{font-size:17px;font-weight:700;color:var(--red2);min-width:24px;text-align:center;}
.slot-inp{
  flex:1;padding:8px 10px;background:#0f0f0f;
  border:1px solid rgba(204,0,0,0.2);border-radius:8px;
  color:#fff;font-family:'Barlow Condensed',Arial,sans-serif;
  font-size:15px;font-weight:600;outline:none;transition:border-color .2s;
}
.slot-inp:focus{border-color:var(--red2);}
.slot-inp::placeholder{color:#444;font-weight:400;}
.slot-del{
  width:30px;height:30px;background:#1a0000;
  border:1px solid rgba(204,0,0,0.3);border-radius:7px;
  color:var(--red2);font-size:15px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.slot-del:active{background:var(--red);color:#fff;}

.add-btn{
  width:100%;padding:11px;background:#0f0f0f;
  border:1px dashed rgba(204,0,0,0.4);border-radius:10px;
  color:var(--muted);font-family:'Barlow Condensed',Arial,sans-serif;
  font-size:13px;letter-spacing:2px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;gap:8px;
  margin-bottom:0;transition:all .2s;
}
.add-btn:active{border-color:var(--red2);color:#fff;}

.sticky-foot{
  width:100%;max-width:460px;
  padding:14px 14px 20px;
  position:sticky;bottom:0;
  background:linear-gradient(transparent,var(--dark) 35%);
}

/* ‚îÄ‚îÄ TABLE PAGE ‚îÄ‚îÄ */
#tablePage{justify-content:flex-start;}
.tbl-head{
  width:100%;
  background:linear-gradient(180deg,#1a0000,var(--dark));
  border-bottom:2px solid var(--border);
  padding:12px 14px;
  display:flex;align-items:center;justify-content:space-between;
}
.tbl-head-left h2{font-size:20px;font-weight:900;letter-spacing:3px;}
.tbl-head-left p{font-size:10px;color:var(--muted);letter-spacing:2px;margin-top:2px;}
.kill-badge{text-align:right;}
.kill-badge span{font-size:10px;color:var(--muted);letter-spacing:1px;display:block;}
.kill-badge b{font-size:28px;font-weight:900;color:var(--red2);line-height:1;}

.act-bar{
  width:100%;display:flex;gap:7px;padding:9px 12px;
  background:var(--dark2);border-bottom:1px solid rgba(204,0,0,0.15);
  overflow-x:auto;
}
.act-bar::-webkit-scrollbar{display:none;}
.act{
  flex-shrink:0;padding:8px 13px;border:none;border-radius:8px;
  font-family:'Barlow Condensed',Arial,sans-serif;
  font-size:12px;font-weight:700;letter-spacing:1px;
  cursor:pointer;text-transform:uppercase;transition:opacity .15s;
}
.act:active{opacity:.6;}
.act-r{background:rgba(204,0,0,0.18);color:var(--red2);border:1px solid var(--border);}
.act-g{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.3);}
.act-b{background:rgba(0,150,255,0.1);color:#55aaff;border:1px solid rgba(0,150,255,0.3);}
.act-w{background:rgba(255,255,255,0.06);color:#aaa;border:1px solid rgba(255,255,255,0.12);}

/* PODIUM */
.podium{
  width:100%;max-width:460px;
  display:flex;gap:7px;align-items:flex-end;
  padding:12px 12px 0;
}
.pod{
  flex:1;border-radius:10px 10px 0 0;
  padding:10px 5px;text-align:center;
  overflow:hidden;
}
.pod1{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.4);border-bottom:none;min-height:88px;}
.pod2{background:rgba(192,192,192,0.08);border:1px solid rgba(192,192,192,0.3);border-bottom:none;min-height:72px;}
.pod3{background:rgba(205,127,50,0.08);border:1px solid rgba(205,127,50,0.3);border-bottom:none;min-height:60px;}
.pod-ico{font-size:20px;display:block;margin-bottom:2px;}
.pod-name{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pod-sc{font-size:20px;font-weight:900;}
.pod1 .pod-sc{color:var(--gold);}
.pod2 .pod-sc{color:var(--silver);}
.pod3 .pod-sc{color:var(--bronze);}

/* TABLE */
.tbl-scroll{width:100%;overflow-x:auto;padding:0 10px 30px;max-width:460px;}
.tbl-scroll::-webkit-scrollbar{height:3px;}
.tbl-scroll::-webkit-scrollbar-thumb{background:var(--red);border-radius:2px;}

table{border-collapse:collapse;width:100%;min-width:680px;font-size:13px;}
thead tr{background:var(--red);}
th{
  padding:9px 7px;text-align:center;font-size:10px;
  letter-spacing:1.5px;font-weight:700;color:#fff;
  white-space:nowrap;position:sticky;top:0;z-index:2;
}
td{
  padding:9px 7px;text-align:center;
  border-bottom:1px solid rgba(255,255,255,0.05);color:#fff;
}
.r1 td{background:rgba(255,215,0,0.09)!important;}
.r2 td{background:rgba(192,192,192,0.06)!important;}
.r3 td{background:rgba(205,127,50,0.06)!important;}
td[contenteditable]{background:rgba(255,255,255,0.03);cursor:text;}
td[contenteditable]:focus{background:rgba(204,0,0,0.18);outline:none;box-shadow:inset 0 0 0 1px var(--red2);}
.td-t{font-weight:700;font-size:15px;}
.td-g{font-weight:900;font-size:17px;color:var(--gold);}

/* TOAST */
.toast{
  position:fixed;top:16px;left:50%;transform:translateX(-50%);
  background:#1a0000;border:1px solid var(--red2);border-radius:10px;
  padding:11px 22px;font-size:13px;font-weight:700;letter-spacing:1px;
  color:#fff;z-index:999;opacity:0;pointer-events:none;
  transition:opacity .3s;white-space:nowrap;
}
.toast.on{opacity:1;}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:100;justify-content:center;align-items:center;}
.overlay.on{display:flex;}
.modal{
  width:88%;max-width:320px;background:var(--card);
  border:1px solid var(--border);border-radius:16px;
  padding:26px 20px;text-align:center;
}
.modal h3{font-size:18px;font-weight:700;letter-spacing:2px;color:var(--red2);margin-bottom:8px;}
.modal p{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:18px;}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL RESET -->
<div class="overlay" id="modalReset">
  <div class="modal">
    <h3>‚ö†Ô∏è RESET DATA</h3>
    <p>Semua data team dan poin<br>akan dihapus permanen!</p>
    <button class="btn btn-red" onclick="doReset()">Ya, Reset Semua</button>
    <button class="btn btn-ghost" onclick="closeModal()">Batal</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="loginPage" class="page active">
  <div class="login-box">
    <div class="login-ff">‚ö° FREE FIRE TOURNAMENT</div>
    <div class="login-title">HITUNG POIN</div>
    <div class="login-by">BY ISALL</div>
    <div class="login-line"></div>
    <input class="inp" type="password" id="passInput" placeholder="Masukkan Password"
      onkeydown="if(event.key==='Enter')doLogin()">
    <button class="btn btn-red" onclick="doLogin()">üîì LOGIN</button>
    <button class="btn btn-ghost" onclick="reqAdmin()">üì± Request Admin</button>
    <div style="margin-top:14px;font-size:10px;color:#333;letter-spacing:1px;">v3.0 FIXED</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TEAM INPUT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="teamPage" class="page">
  <div class="pg-head">
    <h2>‚öîÔ∏è DAFTAR TEAM</h2>
    <p>MINIMAL 2 TEAM ¬∑ MAKSIMAL 12 TEAM</p>
  </div>
  <div class="team-body" id="teamBody">
    <div class="count-bar">
      <span class="count-label">Jumlah Team</span>
      <span class="count-val" id="cntVal">0 / 12</span>
    </div>
    <div id="slotList"></div>
    <button class="add-btn" id="addBtn" onclick="addSlot()">
      <span style="font-size:18px;color:var(--red2)">Ôºã</span> TAMBAH TEAM
    </button>
  </div>
  <div class="sticky-foot">
    <button class="btn btn-red" onclick="saveTeams()">‚úÖ SIMPAN &amp; LANJUT</button>
    <button class="btn btn-ghost" onclick="doLogout()">Logout</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tablePage" class="page">
  <div class="tbl-head">
    <div class="tbl-head-left">
      <h2>üèÜ LEADERBOARD</h2>
      <p>BY ISALL ¬∑ MASTER LEAGUE ¬∑ 3 MATCH</p>
    </div>
    <div class="kill-badge">
      <span>POIN/KILL</span>
      <b>√ó2</b>
    </div>
  </div>

  <div class="act-bar">
    <button class="act act-g" onclick="doDownloadIMG()">üì∑ FOTO</button>
    <button class="act act-b" onclick="doDownloadPDF()">üìÑ PDF</button>
    <button class="act act-r" onclick="goEditTeam()">‚úèÔ∏è EDIT TIM</button>
    <button class="act act-r" onclick="openModal()">üóë RESET</button>
    <button class="act act-w" onclick="doLogout()">LOGOUT</button>
  </div>

  <div class="podium" id="podium" style="display:none"></div>

  <div class="tbl-scroll">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th style="text-align:left">TEAM</th>
          <th>M1<br>KILL</th><th>M1<br>RANK</th><th>M1<br>TOT</th>
          <th>M2<br>KILL</th><th>M2<br>RANK</th><th>M2<br>TOT</th>
          <th>M3<br>KILL</th><th>M3<br>RANK</th><th>M3<br>TOT</th>
          <th>GRAND<br>TOTAL</th>
        </tr>
      </thead>
      <tbody id="tBody"></tbody>
    </table>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STORAGE ‚Äî aman untuk WebView/AppsGeyser
   Gunakan sessionStorage dulu, fallback memory
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var _mem = {}; // fallback jika semua storage gagal

function stor_set(key, val) {
  var s = JSON.stringify(val);
  try { localStorage.setItem(key, s); return; } catch(e){}
  try { sessionStorage.setItem(key, s); return; } catch(e){}
  _mem[key] = s;
}
function stor_get(key) {
  var s = null;
  try { s = localStorage.getItem(key); } catch(e){}
  if (!s) { try { s = sessionStorage.getItem(key); } catch(e){} }
  if (!s) { s = _mem[key] || null; }
  if (!s) return null;
  try { return JSON.parse(s); } catch(e){ return null; }
}
function stor_del(key) {
  try { localStorage.removeItem(key); } catch(e){}
  try { sessionStorage.removeItem(key); } catch(e){}
  delete _mem[key];
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PASSWORDS & STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var PASS = ["adminA1","adminB2","adminC3","adminD4","adminE5"];

// Poin placement sesuai Master League S2
var RANK_PTS = [20,17,15,13,12,10,6,4,3,2,1,0];
function rankPt(r){ var i=parseInt(r)-1; return(i>=0&&i<RANK_PTS.length)?RANK_PTS[i]:0; }
var KILL_X = 2;

var teams = []; // [{name,k1,r1,k2,r2,k3,r3}, ...]
var isLoggedIn = false;
var slotCount = 0;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var _tTimer;
function showToast(msg, color) {
  var el = document.getElementById('toast');
  el.textContent = msg;
  el.style.borderColor = color || 'var(--red2)';
  el.classList.add('on');
  clearTimeout(_tTimer);
  _tTimer = setTimeout(function(){ el.classList.remove('on'); }, 2600);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PAGE SWITCH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showPage(id) {
  document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
  document.getElementById(id).classList.add('active');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function doLogin() {
  var p = document.getElementById('passInput').value.trim();
  if (!p) { showToast('‚ö†Ô∏è Masukkan password!'); return; }

  if (PASS.indexOf(p) === -1) {
    showToast('‚ùå Password salah!');
    return;
  }

  // Cek device lock (opsional ‚Äî skip jika stor gagal)
  var dev = stor_get('ff_device');
  if (dev && dev !== p) {
    showToast('‚ö†Ô∏è Password sudah dipakai di HP lain!');
    return;
  }

  // Simpan sesi
  stor_set('ff_device', p);
  stor_set('ff_auth', '1');
  isLoggedIn = true;

  showToast('‚úÖ Login berhasil!', '#44ff44');

  setTimeout(function(){
    loadTeams();
    if (teams.length >= 2) showTablePage();
    else showTeamPage();
  }, 500);
}

function doLogout() {
  stor_del('ff_auth');
  isLoggedIn = false;
  teams = [];
  showPage('loginPage');
  document.getElementById('passInput').value = '';
}

function reqAdmin() {
  window.open('https://wa.me/6281234567890?text=Request%20akses%20admin%20Hitung%20Poin%20By%20Isall');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOAD & SAVE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadTeams() {
  var d = stor_get('ff_teams');
  teams = d || [];
}
function saveTeamsData() {
  stor_set('ff_teams', teams);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TEAM SLOTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showTeamPage() {
  showPage('teamPage');
  renderSlots();
}

function renderSlots() {
  var list = document.getElementById('slotList');
  list.innerHTML = '';
  slotCount = 0;
  if (teams.length === 0) {
    addSlot(); // mulai 1 slot kosong
  } else {
    teams.forEach(function(t, i){ addSlotEl(i, t.name); });
  }
  refreshCount();
}

function addSlot() {
  if (slotCount >= 12) { showToast('Maksimal 12 team!'); return; }
  addSlotEl(slotCount, '');
  refreshCount();
}

function addSlotEl(idx, val) {
  var list = document.getElementById('slotList');
  var d = document.createElement('div');
  d.className = 'slot' + (val ? ' filled' : '');
  d.id = 'sl_' + slotCount;
  d.innerHTML =
    '<div class="slot-no">' + (slotCount+1) + '</div>' +
    '<input class="slot-inp" type="text" placeholder="Nama team ' + (slotCount+1) + '" value="' + esc(val) + '" ' +
      'oninput="onInp(this)">' +
    '<button class="slot-del" onclick="delSlot(this)">‚úï</button>';
  list.appendChild(d);
  slotCount++;
  document.getElementById('addBtn').style.display = slotCount >= 12 ? 'none' : 'flex';
}

function onInp(el) {
  var slot = el.closest('.slot');
  if (slot) slot.classList.toggle('filled', el.value.trim() !== '');
}

function delSlot(btn) {
  var slot = btn.closest('.slot');
  if (slot) slot.remove();
  reIndex();
}

function reIndex() {
  var slots = document.querySelectorAll('.slot');
  slotCount = slots.length;
  slots.forEach(function(s, i){
    s.id = 'sl_' + i;
    s.querySelector('.slot-no').textContent = i+1;
    var inp = s.querySelector('.slot-inp');
    inp.placeholder = 'Nama team ' + (i+1);
  });
  refreshCount();
  document.getElementById('addBtn').style.display = slotCount >= 12 ? 'none' : 'flex';
}

function refreshCount() {
  document.getElementById('cntVal').textContent = slotCount + ' / 12';
}

function saveTeams() {
  var slots = document.querySelectorAll('.slot');
  var names = [];
  slots.forEach(function(s){
    var v = s.querySelector('.slot-inp').value.trim();
    if (v) names.push(v);
  });
  if (names.length < 2) { showToast('‚ö†Ô∏è Minimal 2 team!'); return; }

  var old = teams.slice();
  teams = names.map(function(name){
    var prev = null;
    for (var i=0;i<old.length;i++){ if(old[i].name===name){prev=old[i];break;} }
    return prev || { name:name, k1:0,r1:1,k2:0,r2:1,k3:0,r3:1 };
  });
  saveTeamsData();
  showToast('‚úÖ Tersimpan!', '#44ff44');
  setTimeout(showTablePage, 500);
}

function goEditTeam() { showTeamPage(); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function calcT(t) {
  var m1 = t.k1*KILL_X + rankPt(t.r1);
  var m2 = t.k2*KILL_X + rankPt(t.r2);
  var m3 = t.k3*KILL_X + rankPt(t.r3);
  return { m1:m1, m2:m2, m3:m3, tot:m1+m2+m3 };
}

function showTablePage() {
  showPage('tablePage');
  renderTable();
}

function renderTable() {
  var sorted = teams.map(function(t,i){
    var c = calcT(t);
    return { idx:i, name:t.name, k1:t.k1,r1:t.r1, k2:t.k2,r2:t.r2, k3:t.k3,r3:t.r3,
             m1:c.m1, m2:c.m2, m3:c.m3, tot:c.tot };
  });
  sorted.sort(function(a,b){ return b.tot - a.tot; });

  var tbody = document.getElementById('tBody');
  tbody.innerHTML = '';

  sorted.forEach(function(t, rank){
    var rc = rank===0?'r1': rank===1?'r2': rank===2?'r3':'';
    var med = rank===0?'ü•á': rank===1?'ü•à': rank===2?'ü•â': (rank+1);
    var i = t.idx;

    var tr = document.createElement('tr');
    tr.className = rc;
    tr.innerHTML =
      '<td>' + med + '</td>' +
      '<td style="text-align:left;font-weight:700;white-space:nowrap">' + esc(t.name) + '</td>' +
      '<td contenteditable oninput="upd(' + i + ',\'k1\',this)">' + t.k1 + '</td>' +
      '<td contenteditable oninput="upd(' + i + ',\'r1\',this)">' + t.r1 + '</td>' +
      '<td class="td-t">' + t.m1 + '</td>' +
      '<td contenteditable oninput="upd(' + i + ',\'k2\',this)">' + t.k2 + '</td>' +
      '<td contenteditable oninput="upd(' + i + ',\'r2
